<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mythfall Loot Tracker</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>🧭 Mythfall Loot Tracker</h1>
    <p>View dungeon drops and live drop rates — always available, even when the bot is offline.</p>
  </header>

  <main>
    <section id="dungeons">
      <!-- Dungeon sections will be inserted here -->
    </section>
  </main>

  <footer>
    <p>Built by Arpee for the Mythfall community</p>
  </footer>

<script>
  const lootData = [
    {
      name: "Pirate Cove",
      drops: [
        "Cutlass",
        "Blunderbuss",
        "Captain's Hat",
        "Gunpowder Egg",
        "Captain's Cape",
        "Pirate Diary (Pg 1)",
        "Pirate Diary (Pg 2)"
      ]
    },
    {
      name: "Coolcrab Grotto",
      drops: [
        "Coolcrab Shades",
        "Dancing Boots",
        "Wedding Band",
        "Tidal Egg",
        "Dance Notes (Pg 1)",
        "Dance Notes (Pg 2)"
      ]
    },
    {
      name: "Luminous Cavern",
      drops: [
        "Luminescent Egg",
        "Jellyhead Cap",
        "White Jelly",
        "Jelly Boots",
        "Jelly Bow",
        "Luminous Tome (Pg 1)",
        "Luminous Tome (Pg 2)"
      ]
    },
    {
      name: "Eldertree Thicket",
      drops: [
        "Elderwood",
        "Rootspike Shuriken",
        "Rootspike Dagger",
        "Acorn Ring",
        "Deciduous Vest",
        "Verdant Egg",
        "Elderwood Book (Pg 1)",
        "Elderwood Book (Pg 2)",
        "Elderwood Book (Pg 3)",
        "Shard"
      ]
    },
    {
      name: "Stoneheart Forest",
      drops: [
        "Rockshard Club",
        "Granite Greatblade",
        "Granite Cape",
        "Rockshard",
        "Stony Egg",
        "Book of Stone (Pg 1)",
        "Book of Stone (Pg 2)",
        "Book of Stone (Pg 3)",
        "Shard"
      ]
    }
  ];

  const normalize = str =>
    str.trim().replace(/’/g, "'").replace(/‘/g, "'").replace(/“|”/g, '"');

  const container = document.getElementById("dungeons");

  lootData.forEach(({ name: dungeon, drops }) => {
    const jsonFile = `data/${dungeon.toLowerCase().replace(/ /g, "")}.json`;

    fetch(jsonFile)
      .then(res => {
        if (!res.ok) throw new Error(`Failed to load ${jsonFile}`);
        return res.json();
      })
      .then(stats => {
        const section = document.createElement("section");
        section.className = "dungeon";

        const title = document.createElement("h2");
        title.textContent = dungeon;
        section.appendChild(title);

        const list = document.createElement("ul");

        const normalizedStats = {};
        if (stats.items) {
          for (const [key, value] of Object.entries(stats.items)) {
            const normalizedKey = normalize(key);
            normalizedStats[normalizedKey] = value;
          }
        }

        drops.forEach(drop => {
          const normalizedDrop = normalize(drop);
          const stat = normalizedStats[normalizedDrop];

          let statText = "";

          if (stat) {
            const { count, rate } = stat;
            statText = `Logged: ${count} (${rate}%)`;
          } else {
            statText = `Logged: 0 (0%) — unlogged`;
          }

          const item = document.createElement("li");
          item.innerHTML = `${drop} <span class="rate">${statText}</span>`;
          list.appendChild(item);
        });

        section.appendChild(list);
        container.appendChild(section);
      })
      .catch(err => {
        const errorMsg = document.createElement("p");
        errorMsg.style.color = "red";
        errorMsg.textContent = `Failed to load ${dungeon} stats.`;
        container.appendChild(errorMsg);
      });
  });
</script>
</body>
</html>
